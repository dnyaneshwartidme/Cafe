<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Indian Cafe Menu</title>
    <link rel="stylesheet" href="static/style.css" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style></style>
  </head>
  <body>
    <div class="menu-container">
      <div class="header">
        <h1>MAULI CAFE</h1>
        <p>Contact No.: +91 9876543210</p>
        <p>
          Address: Dhankar len, Ravivar karanja, frint of Tuljabhavani Temple
        </p>
      </div>

      <div class="section">
        {% for category, items in menu.items() %}
        <div class="menu-group">
          <h2>{{ category }}</h2>
          {% for item in items %}
          <div class="menu-item" data-id="{{ item.id }}">
            <span class="item-name">{{ item.name }}</span>
            <span class="item-price">₹{{ item.price }}</span>
            <div class="quantity-controls">
              <button onclick="decrease(this)">−</button>
              <span class="qty">{{ item.quntity }}</span>
              <button onclick="increase(this)">+</button>
            </div>
          </div>
          {% endfor %}
        </div>
        {% endfor %}
      </div>
      <div class="btn-container">
        <button onclick="placeOrder()" class="btn btn-primary">
          Place Order
        </button>

        <button><a href="bill" class="button-link">Show Bill</a></button>
      </div>
      <!-- Order Confirmation Modal -->
      <div
        class="modal fade"
        id="orderModal"
        tabindex="-1"
        aria-labelledby="orderModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header bg-success text-white">
              <h5 class="modal-title" id="orderModalLabel">Order Placed!</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <p>Your order has been successfully placed.</p>
              <ul id="order-summary" class="list-group list-group-flush"></ul>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">email: maulicafe@gmail.com | www.maulicafe.co.in</div>
    </div>

    <script>
      let updatedQuantities = {};

      function increase(btn) {
        const qtySpan = btn.parentElement.querySelector(".qty");
        let current = parseInt(qtySpan.textContent);
        const newQty = current + 1;
        qtySpan.textContent = newQty;

        const itemId = btn.closest(".menu-item").dataset.id;
        updatedQuantities[itemId] = newQty;
      }

      function decrease(btn) {
        const qtySpan = btn.parentElement.querySelector(".qty");
        let current = parseInt(qtySpan.textContent);
        if (current > 0) {
          const newQty = current - 1;
          qtySpan.textContent = newQty;

          const itemId = btn.closest(".menu-item").dataset.id;
          updatedQuantities[itemId] = newQty;
        }
      }

      function placeOrder() {
        const payload = Object.entries(updatedQuantities).map(
          ([id, quntity]) => ({
            id: parseInt(id),
            quntity: quntity,
          })
        );

        fetch("/place_order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        }).then((res) => {
          if (res.ok) {
            // ✅ Populate modal order summary
            const summaryList = document.getElementById("order-summary");
            summaryList.innerHTML = "";

            for (const [id, qty] of Object.entries(updatedQuantities)) {
              const itemName =
                document.querySelector(`.menu-item[data-id="${id}"] .item-name`)
                  ?.textContent || `Item ${id}`;
              const li = document.createElement("li");
              li.classList.add("list-group-item");
              li.textContent = `${itemName} × ${qty}`;
              summaryList.appendChild(li);
            }

            updatedQuantities = {}; // Clear
            const orderModal = new bootstrap.Modal(
              document.getElementById("orderModal")
            );
            orderModal.show(); // ✅ Show Bootstrap modal
          } else {
            alert("Failed to place order.");
          }
        });
      }
    </script>
    <!-- Bootstrap JS Bundle (includes Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
